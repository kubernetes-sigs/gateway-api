# GEP-2694: Support

* Issue: [#2694](https://github.com/kubernetes-sigs/gateway-api/issues/2694)
* Status: Provisional

## TLDR

This GEP proposes adding regex support for path **redirects and rewrites**.

## Goals

* Enable replacements with a [Regular Expression] substitution

## API

Although not all Gateway API implementations support the same regex engines, it is important to find a more commonly supported regex and establish a specification.

* Path redirects
* Host rewrites

## Portability

Different gateway APIs support different regexes, we need to find a widely supported regex.

| Gateway APIs         | Regex                                                                                                                          |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------|
| Istio                | [RE2](https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPMatchRequest)                              |
| Google Cloud         | [RE2](https://cloud.google.com/api-gateway/docs/path-templating)                                                               |
| Cilium               | [RE2](https://github.com/cilium/cilium/blob/69ee9e95a5fd9059605893219b59ccf7297d49c5/api/v1/flow/README.md?plain=1#L348)       |
| Envoy Gateway        | [RE2](https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/regex.proto)                                          |
| Contour              | [RE2](https://github.com/projectcontour/contour#overview)                                                                      |
| Emissary Ingress     | [RE2](https://github.com/emissary-ingress/emissary/blob/master/CHANGELOG.md#300-june-27-2022)                                  |
| Gloo Edge            | [RE2](https://docs.solo.io/gloo-edge/latest/guides/traffic_management/request_processing/regex_rewrite/)                       |
| Hashicorp Consul     | [RE2](https://developer.hashicorp.com/terraform/language/functions/regex)                                                      |
| Kuma                 | [RE2](https://kuma.io/docs/2.8.x/policies/traffic-metrics/#filter-envoy-metrics)                                               |
| Flomesh Service Mesh | [RE2](https://github.com/flomesh-io/fsm/blob/2d0e40b4a04431b1518a9d4f388b5363cef524be/docs/how_fsm_uses_envoy.md?plain=1#L180) |
| HAProxy              | [PCRE](https://discourse.haproxy.org/t/documentation-about-regex-syntax/2019/3)                                                |
| NGINX                | [PCRE](https://www.f5.com/company/blog/nginx/regular-expression-tester-nginx)                                                  |
| KONG                 | [PCRE](https://docs.konghq.com/gateway/latest/key-concepts/routes/#regular-expressions)                                        |
| HAProxy              | [PCRE](https://discourse.haproxy.org/t/documentation-about-regex-syntax/2019/3)                                                |
| Litespeed            | [PCRE](https://docs.litespeedtech.com/cloud/kubernetes/gateway/#extended-gateway-features)                                     |
| Traefik              | [REGEXP](https://github.com/search?q=repo%3Atraefik%2Ftraefik+regexp&type=code)                                                |

## Alternatives

In the realm of regex, there is no way to perfectly unify regex specific implementations from
what is available. According to the existing way of handling, a better solution is to let users
decide their own implementation, and not to make restrictions at the API level. For a more
user-friendly experience, documentation of the type of Different gateway APIs support regexes
is available (That's acceptable).

## References

Issues:

- [#2177: Support regex based path rewrites](https://github.com/kubernetes-sigs/gateway-api/issues/2177)
- [#2694: Enhancment: HTTPRoute support match by RegularExpression](https://github.com/kubernetes-sigs/gateway-api/issues/2694)

Pull Request:

- [#639: Add note about "implementation-specific" vs conformance levels](https://github.com/kubernetes-sigs/gateway-api/pull/639)