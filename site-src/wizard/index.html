<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gateway API Controller Matching Wizard</title>
  <link rel="stylesheet" href="controller-wizard.css">
</head>

<body>
  <div class="intro">
    <p id="version-row">
      <label for="version-select"><strong>Gateway API version:</strong></label>
      <select id="version-select"></select>
    </p>
    <p>For each feature, select <strong>Must have</strong>, <strong>Nice to have</strong>, or <strong>N/A</strong>. Feature names match the
      <a id="link-intro-conformance" href="https://gateway-api.sigs.k8s.io/implementations/v1.4/" target="_blank" rel="noopener">v1.4
        conformance tables</a>.</p>
    <p class="intro-source">Matches are generated from the
      <a href="https://github.com/kubernetes-sigs/gateway-api/tree/main/conformance/reports" target="_blank" rel="noopener">conformance reports uploaded by project implementations</a>.
      They are separated into the extended features that each project supports listed in their reports.
      Implementations only appear in this page if they pass Core conformance for the resource type, and the features listed are Extended features.
      Implementations that submit conformance reports with skipped tests won't appear.</p>
    <details class="warning-note" open>
      <summary>Note</summary>
      <p>This page is under active development and is not in its final form, especially for the project name and the names of the features. However, as it is based on submitted conformance reports, the information is correct.</p>
    </details>
  </div>

  <section class="card">
    <h2>Gateway Profile</h2>

    <h3 id="gateway">Gateway</h3>
    <p class="section-intro">All controllers matched by this wizard include core support of Gateway. That includes many core features, including:</p>
    <ul class="core-list">
      <li>Specifying listeners on different ports and protocols</li>
      <li>TLS configuration (protocol dependent)</li>
      <li>Hostname matching (protocol dependent)</li>
      <li>Configuring which Routes can be attached, including the ability to accept Routes from other namespaces</li>
    </ul>
    <p class="section-intro">If you'd like additional Gateway features, you can choose from the following list of extended (optional) features.</p>
    <table class="features" id="gateway-features">
      <thead><tr><th scope="col">Gateway</th><th scope="col">Requirement</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3 id="httproute">HTTPRoute</h3>
    <p class="section-intro">Controllers that pass conformance tests for HTTPRoute are guaranteed to support the following features:</p>
    <ol class="core-list">
      <li>Traffic splitting with weighted backends</li>
      <li>Safe cross-namespace references with ReferenceGrant</li>
      <li>Request header modification</li>
      <li>Exact and prefix path matching</li>
      <li>Hostname matching</li>
      <li>HTTP redirects</li>
    </ol>
    <table class="features" id="http-route-core">
      <thead><tr><th scope="col">HTTPRoute</th><th scope="col">Requirement</th></tr></thead>
      <tbody></tbody>
    </table>
    <p class="section-intro">You can choose additional extended features from the <a id="link-httproute" href="https://gateway-api.sigs.k8s.io/implementations/v1.4/#httproute" target="_blank" rel="noopener">HTTPRoute conformance table</a>.</p>
    <table class="features" id="http-route-features">
      <tbody></tbody>
    </table>

    <h3 id="backend-tls">Backend TLS</h3>
    <p class="section-intro">If you need TLS to backends, you can select the following extended features.</p>
    <table class="features" id="backend-tls-features">
      <tbody></tbody>
    </table>

    <h3 id="grpcroute">GRPCRoute</h3>
    <p class="conformance-intro">Extended features from the <a id="link-grpcroute"
        href="https://gateway-api.sigs.k8s.io/implementations/v1.4/#grpcroute" target="_blank" rel="noopener">GRPCRoute
        conformance table</a>.</p>
    <table class="features" id="grpc-features">
      <tbody></tbody>
    </table>

    <h3 id="tlsroute">TLSRoute</h3>
    <p class="conformance-intro">Extended features from the <a id="link-tlsroute"
        href="https://gateway-api.sigs.k8s.io/implementations/v1.4/#tlsroute" target="_blank" rel="noopener">TLSRoute
        conformance table</a>.</p>
    <table class="features" id="tls-features">
      <tbody></tbody>
    </table>
  </section>

  <p id="wizard-data-status" class="data-status"></p>
  <button type="button" class="recommend-btn" id="recommend-btn" disabled>Match</button>
  <button type="button" class="reset-btn" id="reset-btn">Reset</button>

  <section class="card" id="results">
    <h2>Matching controllers</h2>
    <div id="results-content"></div>
  </section>

  <div id="feature-desc-popup" class="feature-desc-popup" role="tooltip" aria-live="polite" hidden></div>

  <script src="wasm_exec.js"></script>
  <script>
    // Click-to-show feature description (works with WASM-rendered table)
    function setupFeatureDescPopup() {
      const popup = document.getElementById('feature-desc-popup');
      if (!popup || popup.hasAttribute('data-initialized')) return;
      popup.setAttribute('data-initialized', '1');
      document.body.addEventListener('click', function (e) {
        const cell = e.target.closest('td.feature-label-cell[data-description]');
        if (cell) {
          e.preventDefault();
          var desc = cell.getAttribute('data-description');
          if (popup.getAttribute('data-open') === '1' && popup.textContent === desc) {
            popup.hidden = true;
            popup.removeAttribute('data-open');
            return;
          }
          popup.textContent = desc || '';
          popup.hidden = false;
          popup.setAttribute('data-open', '1');
          var rect = cell.getBoundingClientRect();
          popup.style.left = rect.left + 'px';
          popup.style.top = (rect.bottom + 4) + 'px';
          popup.style.maxWidth = Math.max(280, Math.min(400, window.innerWidth - rect.left - 16)) + 'px';
          return;
        }
        if (!popup.contains(e.target)) {
          popup.hidden = true;
          popup.removeAttribute('data-open');
        }
      });
    }
    if (document.body) setupFeatureDescPopup(); else document.addEventListener('DOMContentLoaded', setupFeatureDescPopup);
    function setupCoreOptionMutualExclusion() {}
    if (document.body) setupCoreOptionMutualExclusion(); else document.addEventListener('DOMContentLoaded', setupCoreOptionMutualExclusion);
    // When embedded in MkDocs iframe: tell parent our height so it can use one scroll.
    window.wizardResize = function() {
      if (window.parent !== window) {
        var h = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);
        window.parent.postMessage({ type: 'wizard-height', height: h }, '*');
      }
    };
    setTimeout(window.wizardResize, 0);

    const statusEl = document.getElementById('wizard-data-status');
    statusEl.textContent = 'Loadingâ€¦';

    const go = new Go();
    fetch('main.wasm')
      .then(function (r) {
        if (!r.ok) throw new Error('main.wasm not found (404). Run: make wizard-wasm');
        return WebAssembly.instantiateStreaming(r, go.importObject);
      })
      .then(function (result) {
        go.run(result.instance);
      })
      .catch(function (err) {
        statusEl.textContent = err.message || 'Could not load wizard. Run: make wizard-wasm. Then serve from site-src/wizard/ (e.g. cd site-src/wizard && python3 -m http.server 8000) and open http://localhost:8000/';
        document.getElementById('recommend-btn').disabled = false;
        window.wizardResize();
      });
  </script>
</body>

</html>
